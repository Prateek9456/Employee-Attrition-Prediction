<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Employee Attrition Prediction System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="bg-gray-50">
    <div class="min-h-screen p-6">
        <div class="max-w-7xl mx-auto">
            <!-- Header -->
            <div class="mb-8 text-center">
                <h1 class="text-5xl font-bold text-gray-900 mb-3">üéØ Employee Attrition Prediction</h1>
                <p class="text-xl text-gray-600">AI-Powered Retention Intelligence with Explainable Insights</p>
                <div class="mt-4 inline-block bg-green-100 text-green-800 px-4 py-2 rounded-full font-semibold">
                    ‚úÖ API Connected
                </div>
            </div>

            <div class="grid md:grid-cols-2 gap-8">
                <!-- LEFT: Input Form -->
                <div class="bg-white rounded-xl shadow-lg p-8">
                    <h2 class="text-2xl font-bold mb-6 flex items-center">
                        <span class="bg-blue-100 text-blue-600 rounded-full w-8 h-8 flex items-center justify-center mr-3">1</span>
                        Enter Employee Data
                    </h2>
                    
                    <form id="prediction-form" class="space-y-4">
                        <!-- Basic Info -->
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">Age</label>
                                <input type="number" name="Age" value="35" required 
                                    class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                            </div>
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">Gender</label>
                                <select name="Gender" required 
                                    class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                                    <option>Male</option>
                                    <option>Female</option>
                                </select>
                            </div>
                        </div>

                        <!-- Department & Role -->
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Department</label>
                            <select name="Department" required 
                                class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                                <option>Sales</option>
                                <option>Research & Development</option>
                                <option>Human Resources</option>
                            </select>
                        </div>

                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Job Role</label>
                            <select name="JobRole" required 
                                class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                                <option>Sales Executive</option>
                                <option>Research Scientist</option>
                                <option>Laboratory Technician</option>
                                <option>Manufacturing Director</option>
                                <option>Healthcare Representative</option>
                                <option>Manager</option>
                                <option>Sales Representative</option>
                                <option>Research Director</option>
                                <option>Human Resources</option>
                            </select>
                        </div>

                        <!-- Education -->
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">Education Level (1-5)</label>
                                <input type="number" name="Education" value="3" min="1" max="5" required 
                                    class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                            </div>
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">Education Field</label>
                                <select name="EducationField" required 
                                    class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                                    <option>Life Sciences</option>
                                    <option>Medical</option>
                                    <option>Marketing</option>
                                    <option>Technical Degree</option>
                                    <option>Other</option>
                                    <option>Human Resources</option>
                                </select>
                            </div>
                        </div>

                        <!-- Compensation -->
                        <div class="grid grid-cols-3 gap-4">
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">Monthly Income</label>
                                <input type="number" name="MonthlyIncome" value="5000" required 
                                    class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                            </div>
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">Hourly Rate</label>
                                <input type="number" name="HourlyRate" value="65" required 
                                    class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                            </div>
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">Daily Rate</label>
                                <input type="number" name="DailyRate" value="800" required 
                                    class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                            </div>
                        </div>

                        <!-- Satisfaction Scores -->
                        <div class="bg-blue-50 p-4 rounded-lg">
                            <h3 class="font-semibold text-gray-700 mb-3">Satisfaction Metrics (1-4 scale)</h3>
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-600 mb-1">Job Satisfaction</label>
                                    <input type="number" name="JobSatisfaction" value="3" min="1" max="4" required 
                                        class="w-full px-3 py-2 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-600 mb-1">Environment Satisfaction</label>
                                    <input type="number" name="EnvironmentSatisfaction" value="3" min="1" max="4" required 
                                        class="w-full px-3 py-2 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-600 mb-1">Work-Life Balance</label>
                                    <input type="number" name="WorkLifeBalance" value="3" min="1" max="4" required 
                                        class="w-full px-3 py-2 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-600 mb-1">Relationship Satisfaction</label>
                                    <input type="number" name="RelationshipSatisfaction" value="3" min="1" max="4" required 
                                        class="w-full px-3 py-2 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                                </div>
                            </div>
                        </div>

                        <!-- Work Details -->
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">Job Level (1-5)</label>
                                <input type="number" name="JobLevel" value="2" min="1" max="5" required 
                                    class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                            </div>
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">Job Involvement (1-4)</label>
                                <input type="number" name="JobInvolvement" value="3" min="1" max="4" required 
                                    class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                            </div>
                        </div>

                        <!-- Career Timeline -->
                        <div class="bg-yellow-50 p-4 rounded-lg">
                            <h3 class="font-semibold text-gray-700 mb-3">Career Timeline
                                <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-600 mb-1">Years at Company</label>
                                    <input type="number" name="YearsAtCompany" value="5" required 
                                        class="w-full px-3 py-2 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-600 mb-1">Years in Current Role</label>
                                    <input type="number" name="YearsInCurrentRole" value="3" required 
                                        class="w-full px-3 py-2 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-600 mb-1">Years Since Last Promotion</label>
                                    <input type="number" name="YearsSinceLastPromotion" value="2" required 
                                        class="w-full px-3 py-2 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-600 mb-1">Years with Manager</label>
                                    <input type="number" name="YearsWithCurrManager" value="3" required 
                                        class="w-full px-3 py-2 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                                </div>
                            </div>
                        </div>

                        <!-- Additional Info -->
                        <div class="grid grid-cols-3 gap-4">
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">Total Working Years</label>
                                <input type="number" name="TotalWorkingYears" value="10" required 
                                    class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                            </div>
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">Companies Worked</label>
                                <input type="number" name="NumCompaniesWorked" value="2" required 
                                    class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                            </div>
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">Distance from Home</label>
                                <input type="number" name="DistanceFromHome" value="10" required 
                                    class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                            </div>
                        </div>

                        <!-- Performance -->
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">Performance Rating (1-4)</label>
                                <input type="number" name="PerformanceRating" value="3" min="1" max="4" required 
                                    class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                            </div>
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">Training Times Last Year</label>
                                <input type="number" name="TrainingTimesLastYear" value="3" required 
                                    class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                            </div>
                        </div>

                        <!-- Other Details -->
                        <div class="grid grid-cols-3 gap-4">
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">Business Travel</label>
                                <select name="BusinessTravel" required 
                                    class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                                    <option>Travel_Rarely</option>
                                    <option>Travel_Frequently</option>
                                    <option>Non-Travel</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">Marital Status</label>
                                <select name="MaritalStatus" required 
                                    class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                                    <option>Single</option>
                                    <option>Married</option>
                                    <option>Divorced</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">Over Time</label>
                                <select name="OverTime" required 
                                    class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                                    <option>No</option>
                                    <option>Yes</option>
                                </select>
                            </div>
                        </div>

                        <!-- Final Details -->
                        <div class="grid grid-cols-3 gap-4">
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">Stock Option Level</label>
                                <input type="number" name="StockOptionLevel" value="1" min="0" max="3" required 
                                    class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                            </div>
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">Percent Salary Hike</label>
                                <input type="number" name="PercentSalaryHike" value="15" required 
                                    class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                            </div>
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">Monthly Rate</label>
                                <input type="number" name="MonthlyRate" value="15000" required 
                                    class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                            </div>
                        </div>

                        <button type="submit" 
                            class="w-full bg-gradient-to-r from-blue-600 to-blue-700 text-white py-4 rounded-lg font-bold text-lg hover:from-blue-700 hover:to-blue-800 transition shadow-lg hover:shadow-xl">
                            üîÆ PREDICT ATTRITION RISK
                        </button>
                    </form>
                </div>

                <!-- RIGHT: Results -->
                <div>
                    <div id="results-container" class="hidden">
                        <!-- Risk Gauge -->
                        <div class="bg-white rounded-xl shadow-lg p-8 mb-6">
                            <h2 class="text-2xl font-bold mb-6 flex items-center">
                                <span class="bg-red-100 text-red-600 rounded-full w-8 h-8 flex items-center justify-center mr-3">2</span>
                                Risk Assessment
                            </h2>
                            <div class="text-center py-6">
                                <div id="risk-gauge" class="text-7xl font-black mb-3"></div>
                                <div id="risk-level" class="text-3xl font-bold mb-6"></div>
                                <div class="w-full bg-gray-200 rounded-full h-6 mb-4 overflow-hidden">
                                    <div id="risk-bar" class="h-6 rounded-full transition-all duration-1000"></div>
                                </div>
                                <p class="text-gray-600 text-sm">Powered by XGBoost + SHAP Explainability</p>
                            </div>
                        </div>

                        <!-- Key Factors -->
                        <div class="bg-white rounded-xl shadow-lg p-8 mb-6">
                            <h2 class="text-2xl font-bold mb-6 flex items-center">
                                <span class="bg-yellow-100 text-yellow-600 rounded-full w-8 h-8 flex items-center justify-center mr-3">3</span>
                                üîç Why This Risk? (Explainable AI)
                            </h2>
                            <div id="factors-list" class="space-y-3"></div>
                            <p class="text-xs text-gray-500 mt-4">üìä Based on SHAP (SHapley Additive exPlanations) values</p>
                        </div>

                        <!-- Actions -->
                        <div class="bg-white rounded-xl shadow-lg p-8">
                            <h2 class="text-2xl font-bold mb-6 flex items-center">
                                <span class="bg-green-100 text-green-600 rounded-full w-8 h-8 flex items-center justify-center mr-3">4</span>
                                üí° Recommended Actions
                            </h2>
                            <div id="actions-list" class="space-y-3"></div>
                        </div>
                    </div>

                    <!-- Placeholder when no results -->
                    <div id="placeholder" class="bg-gradient-to-br from-blue-50 to-indigo-50 rounded-xl shadow-lg p-12 text-center">
                        <div class="text-6xl mb-4">üéØ</div>
                        <h3 class="text-2xl font-bold text-gray-700 mb-3">Ready to Predict</h3>
                        <p class="text-gray-600 mb-6">Fill in the employee information on the left and click "Predict" to see results</p>
                        <div class="grid grid-cols-3 gap-4 text-left">
                            <div class="bg-white p-4 rounded-lg">
                                <div class="font-bold text-blue-600 mb-1">87%</div>
                                <div class="text-xs text-gray-600">Model Accuracy</div>
                            </div>
                            <div class="bg-white p-4 rounded-lg">
                                <div class="font-bold text-purple-600 mb-1">0.89</div>
                                <div class="text-xs text-gray-600">ROC-AUC Score</div>
                            </div>
                            <div class="bg-white p-4 rounded-lg">
                                <div class="font-bold text-green-600 mb-1">5+</div>
                                <div class="text-xs text-gray-600">Key Factors</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Footer -->
            <div class="mt-12 text-center text-gray-500 text-sm">
                <p>ü§ñ Powered by XGBoost, SHAP, FastAPI | Addressing Research Gaps in Employee Attrition Prediction</p>
            </div>
        </div>
    </div>

    <script>
        const API_URL = 'http://localhost:8000';

        document.getElementById('prediction-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const formData = new FormData(e.target);
            const data = Object.fromEntries(formData);
            
            // Convert numeric fields
            const numericFields = ['Age', 'DailyRate', 'DistanceFromHome', 'Education', 
                'EnvironmentSatisfaction', 'HourlyRate', 'JobInvolvement', 'JobLevel', 
                'JobSatisfaction', 'MonthlyIncome', 'MonthlyRate', 'NumCompaniesWorked', 
                'PercentSalaryHike', 'PerformanceRating', 'RelationshipSatisfaction', 
                'StockOptionLevel', 'TotalWorkingYears', 'TrainingTimesLastYear', 
                'WorkLifeBalance', 'YearsAtCompany', 'YearsInCurrentRole', 
                'YearsSinceLastPromotion', 'YearsWithCurrManager'];
            
            numericFields.forEach(field => {
                data[field] = parseInt(data[field]);
            });
            
            // Show loading
            document.getElementById('placeholder').innerHTML = `
                <div class="text-6xl mb-4">‚è≥</div>
                <h3 class="text-2xl font-bold text-gray-700 mb-3">Analyzing...</h3>
                <p class="text-gray-600">Running AI prediction model</p>
            `;
            
            try {
                const response = await fetch(`${API_URL}/predict`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                
                if (!response.ok) {
                    throw new Error('API request failed');
                }
                
                const result = await response.json();
                displayResults(result);
            } catch (error) {
                alert('‚ö†Ô∏è Error connecting to API!\n\nMake sure:\n1. You ran "python app.py" in the terminal\n2. The server is running on port 8000\n3. You see "üöÄ Starting API Server..." in the terminal\n\nError: ' + error.message);
                document.getElementById('placeholder').innerHTML = `
                    <div class="text-6xl mb-4">‚ùå</div>
                    <h3 class="text-2xl font-bold text-red-600 mb-3">Connection Error</h3>
                    <p class="text-gray-600">Make sure the API server is running (python app.py)</p>
                `;
            }
        });

        function displayResults(result) {
            // Hide placeholder, show results
            document.getElementById('placeholder').classList.add('hidden');
            document.getElementById('results-container').classList.remove('hidden');
            
            const probability = (result.risk_probability * 100).toFixed(0);
            document.getElementById('risk-gauge').textContent = probability + '%';
            
            const riskLevel = result.risk_level;
            let levelColor, barColor, bgColor;
            
            if (riskLevel === 'HIGH') {
                levelColor = 'text-red-600';
                barColor = 'bg-red-500';
                bgColor = 'bg-red-50';
            } else if (riskLevel === 'MEDIUM') {
                levelColor = 'text-yellow-600';
                barColor = 'bg-yellow-500';
                bgColor = 'bg-yellow-50';
            } else {
                levelColor = 'text-green-600';
                barColor = 'bg-green-500';
                bgColor = 'bg-green-50';
            }
            
            const riskLevelElement = document.getElementById('risk-level');
            riskLevelElement.textContent = riskLevel + ' RISK';
            riskLevelElement.className = `text-3xl font-bold mb-6 ${levelColor}`;
            
            const riskBar = document.getElementById('risk-bar');
            riskBar.style.width = probability + '%';
            riskBar.className = `h-6 rounded-full transition-all duration-1000 ${barColor}`;
            
            // Display factors
            const factorsList = document.getElementById('factors-list');
            factorsList.innerHTML = result.top_factors.map((factor, idx) => `
                <div class="bg-gray-50 p-5 rounded-lg border-l-4 ${factor.impact > 0 ? 'border-red-500' : 'border-green-500'} hover:shadow-md transition">
                    <div class="flex justify-between items-start mb-2">
                        <span class="font-bold text-gray-800">${idx + 1}. ${factor.factor.replace(/_/g, ' ')}</span>
                        <span class="text-sm font-bold px-3 py-1 rounded-full ${factor.impact > 0 ? 'bg-red-100 text-red-700' : 'bg-green-100 text-green-700'}">
                            ${factor.impact > 0 ? '+' : ''}${(factor.impact * 100).toFixed(1)}%
                        </span>
                    </div>
                    <div class="text-sm text-gray-600 mb-1">${factor.direction}</div>
                    <div class="text-xs text-gray-500">Current value: ${factor.value.toFixed(2)}</div>
                </div>
            `).join('');
            
            // Display actions
            const actionsList = document.getElementById('actions-list');
            actionsList.innerHTML = result.recommended_actions.map((action, idx) => {
                let priorityColor;
                if (action.priority === 'Critical') priorityColor = 'bg-red-100 text-red-700 border-red-200';
                else if (action.priority === 'Immediate') priorityColor = 'bg-orange-100 text-orange-700 border-orange-200';
                else if (action.priority === 'High') priorityColor = 'bg-yellow-100 text-yellow-700 border-yellow-200';
                else if (action.priority === 'Medium') priorityColor = 'bg-blue-100 text-blue-700 border-blue-200';
                else priorityColor = 'bg-gray-100 text-gray-700 border-gray-200';
                
                return `
                    <div class="bg-blue-50 p-5 rounded-lg border-l-4 border-blue-500 hover:shadow-md transition">
                        <div class="flex justify-between items-start mb-3">
                            <span class="font-bold text-gray-800">${idx + 1}. ${action.action}</span>
                            <span class="text-xs px-3 py-1 rounded-full font-semibold border ${priorityColor}">
                                ${action.priority}
                            </span>
                        </div>
                        <div class="text-sm text-gray-600">${action.description}</div>
                    </div>
                `;
            }).join('');
            
            // Scroll to results
            document.getElementById('results-container').scrollIntoView({ behavior: 'smooth', block: 'start' });
        }
    </script>
</body>
</html>